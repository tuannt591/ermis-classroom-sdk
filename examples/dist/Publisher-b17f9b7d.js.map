{"version":3,"file":"Publisher-b17f9b7d.js","sources":["../src/media/Publisher.js"],"sourcesContent":["/**\n * WebRTC Publisher Class\n * Handles video/audio streaming via WebTransport\n */\nexport class Publisher {\n  constructor(options = {}) {\n    // Validate required options\n    if (!options.publishUrl) {\n      throw new Error(\"publishUrl is required\");\n    }\n    if (!options.videoElement) {\n      throw new Error(\"videoElement is required\");\n    }\n\n    // Configuration\n    this.publishUrl = options.publishUrl;\n    this.streamType = options.streamType || \"camera\"; // 'camera' or 'display'\n    this.videoElement = options.videoElement;\n    this.streamId = options.streamId || \"test_stream\";\n\n    // Video configuration\n    this.currentConfig = {\n      // codec: \"hev1.1.0.L90.b0\",\n      codec: \"avc1.640c34\",\n      // codec: \"avc1.42E01E\",\n      width: options.width || 1280,\n      height: options.height || 720,\n      framerate: options.framerate || 30,\n      bitrate: options.bitrate || 1_500_000,\n    };\n\n    // Audio configuration\n    this.kSampleRate = 48000;\n    this.opusBaseTime = 0;\n    this.opusSamplesSent = 0;\n    this.opusSamplesPerChunk = 960; // 20ms at 48kHz\n    this.opusChunkCount = 0;\n\n    // State variables\n    this.stream = null;\n    this.audioProcessor = null;\n    this.videoProcessor = null;\n    this.webTransport = null;\n    this.webtransportWriter = null;\n    this.webtransportReader = null;\n    this.isChannelOpen = false;\n    this.mediaConfigSent = false;\n    this.videoMetadataReady = false;\n    this.audioConfig = null;\n    this.videoConfig = null;\n    this.videoDescription = null;\n    this.sequenceNumber = 0;\n    this.isPublishing = false;\n\n    this.cameraEnabled = true;\n    this.micEnabled = true;\n\n    // Callbacks\n    this.onStatusUpdate =\n      options.onStatusUpdate || ((message, isError) => console.log(message));\n    this.onStreamStart = options.onStreamStart || (() => {});\n    this.onStreamStop = options.onStreamStop || (() => {});\n\n    // Initialize modules\n    this.wasmInitialized = false;\n    this.wasmInitializing = false;\n    this.wasmInitPromise = null;\n    this.initAudioRecorder = null;\n    this.WasmEncoder = null;\n\n    this.onServerEvent = options.onServerEvent || ((event) => {});\n\n    // Video encoder\n    this.videoEncoder = new VideoEncoder({\n      output: this.handleVideoChunk.bind(this),\n      error: (e) => this.onStatusUpdate(`Encoder error: ${e.message}`, true),\n    });\n  }\n\n  async init() {\n    await this.loadAllDependencies();\n    this.onStatusUpdate(\"Publisher initialized successfully\");\n  }\n\n  async loadAllDependencies() {\n    try {\n      if (\n        !document.querySelector(\n          'script[src=\"../polyfills/MSTP_polyfill.min.js\"]'\n        )\n      ) {\n        await new Promise((resolve, reject) => {\n          const script = document.createElement(\"script\");\n          script.src = \"../polyfills/MSTP_polyfill.min.js\";\n          script.onload = () => resolve();\n          script.onerror = () =>\n            reject(new Error(\"Failed to load MSTP polyfill\"));\n          document.head.appendChild(script);\n        });\n        console.log(\"Polyfill loaded successfully\");\n      }\n\n      if (!this.wasmInitialized) {\n        if (this.wasmInitializing && this.wasmInitPromise) {\n          await this.wasmInitPromise;\n        } else {\n          this.wasmInitializing = true;\n          const { default: init, WasmEncoder } = await import(\n            \"../raptorQ/raptorq_wasm.js\"\n          );\n          this.WasmEncoder = WasmEncoder;\n\n          this.wasmInitPromise = init()\n            .then(() => {\n              this.wasmInitialized = true;\n              this.wasmInitializing = false;\n              console.log(\"WASM encoder module loaded successfully\");\n            })\n            .catch((err) => {\n              this.wasmInitializing = false;\n              console.error(\"Failed to load WASM encoder module:\", err);\n              throw new Error(\"Failed to load WASM encoder module\");\n            });\n\n          await this.wasmInitPromise;\n        }\n      }\n\n      const opusModule = await import(\n        `/opus_decoder/opusDecoder.js?t=${Date.now()}`\n      );\n      this.initAudioRecorder = opusModule.initAudioRecorder;\n      console.log(\"Opus decoder module loaded successfully\");\n\n      this.onStatusUpdate(\"All dependencies loaded successfully\");\n    } catch (error) {\n      this.onStatusUpdate(`Dependency loading error: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  async startPublishing() {\n    if (this.isPublishing) {\n      this.onStatusUpdate(\"Already publishing\", true);\n      return;\n    }\n    await this.init();\n\n    // Setup WebTransport connection\n    await this.setupConnection();\n\n    try {\n      // Get media stream based on type\n      await this.getMediaStream();\n      this.isPublishing = true;\n      // Start streaming\n      await this.startStreaming();\n\n      this.onStreamStart();\n      this.onStatusUpdate(\"Publishing started successfully\");\n    } catch (error) {\n      this.onStatusUpdate(`Failed to start publishing: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  // Toggle camera\n  toggleCamera() {\n    if (this.cameraEnabled) {\n      this.turnOffCamera();\n    } else {\n      this.turnOnCamera();\n    }\n  }\n\n  // Toggle mic\n  toggleMic() {\n    if (this.micEnabled) {\n      this.turnOffMic();\n    } else {\n      this.turnOnMic();\n    }\n  }\n\n  // Turn off camera (stop encoding video frames)\n  turnOffCamera() {\n    this.cameraEnabled = false;\n    this.videoElement && (this.videoElement.srcObject = null);\n    this.onStatusUpdate(\"Camera turned off\");\n  }\n\n  // Turn on camera (resume encoding video frames)\n  turnOnCamera() {\n    this.cameraEnabled = true;\n    if (\n      this.stream &&\n      this.stream.getVideoTracks().length > 0 &&\n      this.videoElement\n    ) {\n      const videoOnlyStream = new MediaStream();\n      videoOnlyStream.addTrack(this.stream.getVideoTracks()[0]);\n      this.videoElement.srcObject = videoOnlyStream;\n    }\n    this.onStatusUpdate(\"Camera turned on\");\n  }\n\n  // Turn off mic (stop encoding audio chunks)\n  turnOffMic() {\n    this.micEnabled = false;\n    this.onStatusUpdate(\"Mic turned off\");\n  }\n\n  // Turn on mic (resume encoding audio chunks)\n  turnOnMic() {\n    this.micEnabled = true;\n    this.onStatusUpdate(\"Mic turned on\");\n  }\n\n  async getMediaStream() {\n    if (this.streamType === \"camera\") {\n      const constraints = {\n        audio: {\n          sampleRate: this.kSampleRate,\n          channelCount: 1,\n          echoCancellation: true,\n          noiseSuppression: true,\n        },\n        video: {\n          width: { ideal: this.currentConfig.width },\n          height: { ideal: this.currentConfig.height },\n          frameRate: { ideal: this.currentConfig.framerate },\n        },\n      };\n      try {\n        this.stream = await navigator.mediaDevices.getUserMedia(constraints);\n      } catch (error) {\n        console.error(\"Error accessing media devices:\", error);\n      }\n    } else if (this.streamType === \"display\") {\n      this.stream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: true,\n      });\n\n      // Handle user stopping screen share via browser UI\n      const videoTrack = this.stream.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.onended = () => {\n          this.stopPublishing();\n        };\n      }\n    }\n\n    const videoOnlyStream = new MediaStream();\n    const videoTracks = this.stream.getVideoTracks();\n\n    if (videoTracks.length > 0) {\n      videoOnlyStream.addTrack(videoTracks[0]);\n    }\n\n    this.videoElement.srcObject = videoOnlyStream;\n\n    // this.videoElement.srcObject = this.stream;\n    this.onStatusUpdate(`${this.streamType} stream obtained`);\n  }\n\n  async setupConnection() {\n    console.warn(\"Connecting to WebTransport server at\", this.publishUrl);\n    this.webTransport = new WebTransport(this.publishUrl);\n    await this.webTransport.ready;\n    console.log(\"WebTransport connected to server\");\n\n    const stream = await this.webTransport.createBidirectionalStream();\n    const readable = stream.readable;\n    const writable = stream.writable;\n\n    this.webtransportWriter = writable.getWriter();\n    this.webtransportReader = readable.getReader();\n    console.log(\"WebTransport bidirectional stream established\");\n    this.onStatusUpdate(\"WebTransport connection established\");\n\n    setInterval(() => {\n      const ping = new TextEncoder().encode(\"ping\");\n      if (this.isChannelOpen && this.webtransportWriter) {\n        this.sendOverWebTransportStream(ping);\n      }\n    }, 500);\n\n    (async () => {\n      try {\n        while (true) {\n          const { value, done } = await this.webtransportReader.read();\n          if (done) {\n            console.log(\"üîå Bi-directional stream closed by server\");\n            break;\n          }\n          if (value) {\n            const msg = new TextDecoder().decode(value);\n            console.log(\"üì© Message from server:\", msg);\n            if (msg === \"pong\") {\n              continue; // Ignore pong responses\n            }\n            let msgJson;\n            try {\n              msgJson = JSON.parse(msg);\n            } catch (e) {\n              msgJson = null;\n            }\n            if (msgJson && msgJson.event) {\n              console.log(\"Emitting server event:\", msgJson);\n              this.onServerEvent(msgJson);\n            }\n          }\n        }\n      } catch (err) {\n        console.error(\"‚ùå Error reading from bidi stream:\", err);\n      }\n    })();\n    this.isChannelOpen = true;\n  }\n\n  async startStreaming() {\n    // Start video capture\n    await this.startVideoCapture();\n\n    // Start audio streaming\n    this.audioProcessor = await this.startOpusAudioStreaming();\n  }\n\n  async startVideoCapture() {\n    if (!this.stream) {\n      throw new Error(\"No media stream available\");\n    }\n\n    const triggerWorker = new Worker(\"polyfills/triggerWorker.js\");\n    triggerWorker.postMessage({ frameRate: this.currentConfig.framerate });\n\n    const track = this.stream.getVideoTracks()[0];\n    this.videoProcessor = new MediaStreamTrackProcessor(\n      track,\n      triggerWorker,\n      true\n    );\n    const reader = this.videoProcessor.readable.getReader();\n\n    // Configure video encoder\n    this.videoEncoder.configure({\n      codec: this.currentConfig.codec,\n      width: this.currentConfig.width,\n      height: this.currentConfig.height,\n      bitrate: this.currentConfig.bitrate,\n      framerate: this.currentConfig.framerate,\n      latencyMode: \"realtime\",\n      hardwareAcceleration: \"prefer-hardware\",\n      // hevc: { format: \"annexb\", maxBFrames: 0 },/\n    });\n\n    let frameCounter = 0;\n\n    // Process video frames\n    (async () => {\n      try {\n        while (this.isPublishing) {\n          const result = await reader.read();\n          if (result.done) break;\n\n          const frame = result.value;\n\n          if (!window.videoBaseTimestamp) {\n            window.videoBaseTimestamp = frame.timestamp;\n          }\n\n          if (!this.cameraEnabled) {\n            frame.close();\n            continue;\n          }\n\n          if (this.videoEncoder.encodeQueueSize > 2) {\n            frame.close();\n          } else {\n            frameCounter++;\n            const keyFrame = frameCounter % 120 === 0; // Key frame every ~4 seconds\n            this.videoEncoder.encode(frame, { keyFrame });\n            frame.close();\n          }\n        }\n      } catch (error) {\n        this.onStatusUpdate(`Video processing error: ${error.message}`, true);\n      }\n    })();\n  }\n\n  async startOpusAudioStreaming() {\n    if (!this.stream) {\n      throw new Error(\"No media stream available\");\n    }\n\n    const audioTrack = this.stream.getAudioTracks()[0];\n    if (!audioTrack) {\n      throw new Error(\"No audio track found in stream\");\n    }\n\n    const audioRecorderOptions = {\n      encoderApplication: 2051,\n      encoderComplexity: 0,\n      encoderFrameSize: 20,\n      timeSlice: 100,\n    };\n\n    const audioRecorder = await this.initAudioRecorder(\n      audioTrack,\n      audioRecorderOptions\n    );\n    audioRecorder.ondataavailable = this.handleOpusAudioChunk.bind(this);\n\n    await audioRecorder.start({\n      timeSlice: audioRecorderOptions.timeSlice,\n    });\n\n    return audioRecorder;\n  }\n\n  handleVideoChunk(chunk, metadata) {\n    if (metadata && metadata.decoderConfig && !this.videoMetadataReady) {\n      this.videoDescription = metadata.decoderConfig.description;\n      console.warn(\"video config\", metadata.decoderConfig);\n      this.videoConfig = {\n        codec: metadata.decoderConfig.codec,\n        codedWidth: metadata.decoderConfig.codedWidth,\n        codedHeight: metadata.decoderConfig.codedHeight,\n        frameRate: this.currentConfig.framerate,\n        description: metadata.decoderConfig.description,\n      };\n      this.trySendMediaConfig();\n      this.videoMetadataReady = true;\n    }\n\n    const chunkData = new ArrayBuffer(chunk.byteLength);\n    chunk.copyTo(chunkData);\n    const type = chunk.type === \"key\" ? \"video-key\" : \"video-delta\";\n\n    if (!this.mediaConfigSent) {\n      return;\n    }\n\n    const packet = this.createPacketWithHeader(\n      chunkData,\n      chunk.timestamp,\n      type\n    );\n\n    this.sendOverWebTransportStream(packet);\n    this.sequenceNumber++;\n  }\n\n  handleOpusAudioChunk(typedArray) {\n    if (!this.micEnabled) return;\n\n    if (!this.isChannelOpen || !typedArray || typedArray.byteLength === 0)\n      return;\n\n    try {\n      const dataArray = new Uint8Array(typedArray);\n\n      // Check for OGG header signature\n      if (\n        dataArray.length >= 4 &&\n        dataArray[0] === 79 && // \"O\"\n        dataArray[1] === 103 && // \"g\"\n        dataArray[2] === 103 && // \"g\"\n        dataArray[3] === 83 // \"S\"\n      ) {\n        if (!this.audioConfig) {\n          const description = this.createPacketWithHeader(\n            dataArray,\n            performance.now() * 1000,\n            \"audio\"\n          );\n          this.audioConfig = {\n            codec: \"opus\",\n            sampleRate: 48000,\n            numberOfChannels: 1,\n            description,\n          };\n          this.trySendMediaConfig();\n        }\n\n        // Initialize base time on first chunk\n        if (this.opusBaseTime === 0 && window.videoBaseTimestamp) {\n          this.opusBaseTime = window.videoBaseTimestamp;\n          window.audioStartPerfTime = performance.now();\n          this.opusSamplesSent = 0;\n          this.opusChunkCount = 0;\n        } else if (this.opusBaseTime === 0 && !window.videoBaseTimestamp) {\n          this.opusBaseTime = performance.now() * 1000;\n          this.opusSamplesSent = 0;\n          this.opusChunkCount = 0;\n        }\n\n        const timestamp =\n          this.opusBaseTime +\n          Math.floor((this.opusSamplesSent * 1000000) / this.kSampleRate);\n\n        if (this.mediaConfigSent) {\n          const packet = this.createPacketWithHeader(\n            dataArray,\n            timestamp,\n            \"audio\"\n          );\n          this.sendOverWebTransportStream(packet);\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to send audio data:\", error);\n    }\n  }\n\n  async sendOverWebTransportStream(frameBytes) {\n    try {\n      const len = frameBytes.length;\n      const out = new Uint8Array(4 + len);\n      const view = new DataView(out.buffer);\n      view.setUint32(0, len, false); // big-endian\n      out.set(frameBytes, 4);\n      this.webtransportWriter.write(out);\n    } catch (error) {\n      console.error(\"Failed to send data over WebTransport stream:\", error);\n    }\n  }\n\n  createPacketWithHeader(data, timestamp, type) {\n    let adjustedTimestamp = timestamp;\n    if (window.videoBaseTimestamp) {\n      adjustedTimestamp = timestamp - window.videoBaseTimestamp;\n    }\n\n    let safeTimestamp = Math.floor(adjustedTimestamp / 1000);\n    if (safeTimestamp < 0) safeTimestamp = 0;\n\n    const HEADER_SIZE = 5;\n    const MAX_TS = 0xffffffff;\n    const MIN_TS = 0;\n\n    if (safeTimestamp > MAX_TS) safeTimestamp = MAX_TS;\n    if (safeTimestamp < MIN_TS) safeTimestamp = MIN_TS;\n\n    const packet = new Uint8Array(\n      HEADER_SIZE +\n        (data instanceof ArrayBuffer ? data.byteLength : data.length)\n    );\n\n    let frameType = 2;\n    if (type === \"video-key\") frameType = 0;\n    else if (type === \"video-delta\") frameType = 1;\n    else if (type === \"audio\") frameType = 2;\n    else if (type === \"config\") frameType = 3;\n    else frameType = 4; // unknown\n\n    packet[4] = frameType;\n\n    const view = new DataView(packet.buffer, 0, 4);\n    view.setUint32(0, safeTimestamp, false);\n\n    packet.set(\n      data instanceof ArrayBuffer ? new Uint8Array(data) : data,\n      HEADER_SIZE\n    );\n\n    return packet;\n  }\n\n  uint8ArrayToBase64(bytes) {\n    let binary = \"\";\n    const chunkSize = 0x8000; // ~32KB\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      const chunk = bytes.subarray(i, i + chunkSize);\n      binary += String.fromCharCode.apply(null, chunk);\n    }\n    return btoa(binary);\n  }\n\n  trySendMediaConfig() {\n    if (!this.mediaConfigSent && this.audioConfig && this.videoConfig) {\n      const aConfigBase64 = this.uint8ArrayToBase64(\n        new Uint8Array(this.audioConfig.description)\n      );\n      const vConfigUint8 = new Uint8Array(this.videoConfig.description);\n      const vConfigBase64 = this.uint8ArrayToBase64(vConfigUint8);\n      console.warn(\n        \"video config description in base64 before sending:\",\n        vConfigBase64\n      );\n      console.warn(\n        \"video config description in uint8 before sending:\",\n        vConfigUint8\n      );\n\n      const config = {\n        type: \"DecoderConfigs\",\n        audioConfig: {\n          sampleRate: this.audioConfig.sampleRate,\n          numberOfChannels: this.audioConfig.numberOfChannels,\n          codec: this.audioConfig.codec,\n          description: aConfigBase64 || null,\n        },\n        videoConfig: {\n          codec: this.videoConfig.codec,\n          codedWidth: this.videoConfig.codedWidth,\n          codedHeight: this.videoConfig.codedHeight,\n          frameRate: this.videoConfig.frameRate,\n          description: vConfigBase64 || null,\n        },\n      };\n      console.log(\"Sending media configuration:\", config);\n\n      const packet = new TextEncoder().encode(JSON.stringify(config));\n      this.sendOverWebTransportStream(packet);\n\n      this.mediaConfigSent = true;\n      this.onStatusUpdate(\"Media configuration sent\");\n    }\n  }\n\n  async stopPublishing() {\n    if (!this.isPublishing) {\n      return;\n    }\n\n    try {\n      this.isPublishing = false;\n\n      // Close encoders\n      if (this.videoEncoder && this.videoEncoder.state !== \"closed\") {\n        await this.videoEncoder.flush();\n        this.videoEncoder.close();\n      }\n\n      // Stop audio processor\n      if (\n        this.audioProcessor &&\n        typeof this.audioProcessor.stop === \"function\"\n      ) {\n        await this.audioProcessor.stop();\n        this.audioProcessor = null;\n      }\n\n      // Close WebTransport\n      if (this.webtransportWriter) {\n        await this.webtransportWriter.close();\n        this.webtransportWriter = null;\n      }\n\n      if (this.webTransport) {\n        this.webTransport.close();\n        this.webTransport = null;\n      }\n\n      // Stop all tracks\n      if (this.stream) {\n        this.stream.getTracks().forEach((track) => track.stop());\n        this.stream = null;\n      }\n\n      // Reset video element\n      this.videoElement.srcObject = null;\n\n      // Reset state\n      this.isChannelOpen = false;\n      this.mediaConfigSent = false;\n      this.videoMetadataReady = false;\n      this.audioConfig = null;\n      this.videoConfig = null;\n      this.sequenceNumber = 0;\n      this.opusBaseTime = 0;\n      this.opusSamplesSent = 0;\n      this.opusChunkCount = 0;\n\n      // Clear global variables\n      window.videoBaseTimestamp = null;\n      window.audioStartPerfTime = null;\n\n      this.onStreamStop();\n      this.onStatusUpdate(\"Publishing stopped\");\n    } catch (error) {\n      this.onStatusUpdate(`Error stopping publishing: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  // Getters for state\n  get isActive() {\n    return this.isPublishing;\n  }\n\n  get streamInfo() {\n    return {\n      streamType: this.streamType,\n      config: this.currentConfig,\n      sequenceNumber: this.sequenceNumber,\n      mediaConfigSent: this.mediaConfigSent,\n    };\n  }\n}\n"],"names":["Publisher","constructor","options","publishUrl","Error","videoElement","streamType","streamId","currentConfig","codec","width","height","framerate","bitrate","kSampleRate","opusBaseTime","opusSamplesSent","opusSamplesPerChunk","opusChunkCount","stream","audioProcessor","videoProcessor","webTransport","webtransportWriter","webtransportReader","isChannelOpen","mediaConfigSent","videoMetadataReady","audioConfig","videoConfig","videoDescription","sequenceNumber","isPublishing","cameraEnabled","micEnabled","onStatusUpdate","message","isError","console","log","onStreamStart","onStreamStop","wasmInitialized","wasmInitializing","wasmInitPromise","initAudioRecorder","WasmEncoder","onServerEvent","event","videoEncoder","VideoEncoder","output","handleVideoChunk","bind","error","e","init","loadAllDependencies","document","querySelector","Promise","resolve","reject","script","createElement","src","onload","onerror","head","appendChild","default","then","catch","err","opusModule","Date","now","startPublishing","setupConnection","getMediaStream","startStreaming","toggleCamera","turnOffCamera","turnOnCamera","toggleMic","turnOffMic","turnOnMic","srcObject","getVideoTracks","length","videoOnlyStream","MediaStream","addTrack","constraints","audio","sampleRate","channelCount","echoCancellation","noiseSuppression","video","ideal","frameRate","navigator","mediaDevices","getUserMedia","getDisplayMedia","videoTrack","onended","stopPublishing","videoTracks","warn","WebTransport","ready","createBidirectionalStream","readable","writable","getWriter","getReader","setInterval","ping","TextEncoder","encode","sendOverWebTransportStream","value","done","read","msg","TextDecoder","decode","msgJson","JSON","parse","startVideoCapture","startOpusAudioStreaming","triggerWorker","Worker","postMessage","track","MediaStreamTrackProcessor","reader","configure","latencyMode","hardwareAcceleration","frameCounter","result","frame","window","videoBaseTimestamp","timestamp","close","encodeQueueSize","keyFrame","audioTrack","getAudioTracks","audioRecorderOptions","encoderApplication","encoderComplexity","encoderFrameSize","timeSlice","audioRecorder","ondataavailable","handleOpusAudioChunk","start","chunk","metadata","decoderConfig","description","codedWidth","codedHeight","trySendMediaConfig","chunkData","ArrayBuffer","byteLength","copyTo","type","packet","createPacketWithHeader","typedArray","dataArray","Uint8Array","performance","numberOfChannels","audioStartPerfTime","Math","floor","frameBytes","len","out","view","DataView","buffer","setUint32","set","write","data","adjustedTimestamp","safeTimestamp","HEADER_SIZE","MAX_TS","MIN_TS","frameType","uint8ArrayToBase64","bytes","binary","chunkSize","i","subarray","String","fromCharCode","apply","btoa","aConfigBase64","vConfigUint8","vConfigBase64","config","stringify","state","flush","stop","getTracks","forEach","isActive","streamInfo"],"mappings":"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"}